<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 임팩트 리포트 생성 - Code Green</title>
    <link rel="stylesheet" href="impact_reporting.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Roboto+Mono:wght@700&display=swap" rel="stylesheet">
</head>
<body>

    <!-- 랜딩페이지와 동일한 헤더 -->
    <header class="landing-page-header">
        <a href="landing.html" class="logo-text">
            <span class="c-letter">C</span><span class="o-letter">o</span><span class="d-letter">d</span><span class="e-letter">e</span>
            <span class="green-text"> Green</span>
        </a>
        <nav class="nav-links">
            <div class="dropdown">
                <button class="dropdown-btn">Service</button>
                <div class="dropdown-content">
                    <a href="landing.html#intro">AI 임팩트 리포트</a>
                    <a href="landing.html#Hidden-Impact">Hidden 임팩트 발굴</a>
                    <a href="landing.html#Social-Report">심층 소셜벤처 리포트</a>
                </div>
            </div>
            <a href="about_us.html">About us</a>
            <a href="contact.html">Contact</a>
        </nav>
    </header>

    <main class="report-generator-main">
        <div class="intro-text">
            <h1>AI 임팩트 리포트 생성</h1>
            <p>사업계획서, 중간보고서 등 관련 파일을 업로드하면 AI가 분석하여 리포트 초안을 생성합니다.</p>
        </div>

        <div class="generator-container">
            <!-- 왼쪽: 파일 업로드 패a널 -->
            <div class="upload-panel">
                <h3>1. 파일 업로드</h3>
                <div class="upload-split-container">
                    <div id="drop-area-general" class="drop-area">
                        <input type="file" id="file-input-general" hidden multiple accept=".pdf,.doc,.docx,.ppt,.pptx,.txt,.hwp">
                        <div class="drop-area-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                        </div>
                        <p class="drop-area-text">사업계획서 등<br>일반 파일 업로드</p>
                    </div>
                    <div id="drop-area-sroi" class="drop-area">
                        <input type="file" id="file-input-sroi" hidden accept=".xlsx,.xls,.csv">
                        <div class="drop-area-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
                        </div>
                        <p class="drop-area-text">SROI 데이터<br>파일 업로드</p>
                    </div>
                </div>
                <div class="upload-checklist">
                    <div class="check-item">
                        <span id="check-general" class="check-icon"></span>
                        <span>일반 파일 업로드</span>
                    </div>
                    <div class="check-item">
                        <span id="check-sroi" class="check-icon"></span>
                        <span>SROI 파일 업로드</span>
                    </div>
                </div>
            </div>

            <!-- 오른쪽: 업로드된 파일 목록 -->
            <div class="file-panel">
                <h3>2. 업로드된 파일</h3>
                <div id="file-list-container" class="file-list-container">
                    <ul id="file-list" class="file-list"></ul>
                    <div id="file-placeholder" class="file-placeholder">
                        <p>파일을 업로드하면<br>여기에 표시됩니다.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <button id="generate-report-btn" class="generate-report-btn" disabled>✨ AI 리포트 생성하기</button>
    </main>

    <!-- 랜딩페이지와 동일한 푸터 -->
    <footer class="landing-footer">
        <p>&copy; 2025 Code Green. All rights reserved.</p>
        <div><a href="#">Privacy Policy</a> | <a href="#">Terms of Service</a></div>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 헤더 관련 스크립트 (랜딩페이지와 동일)
            const dropdownBtn = document.querySelector('.dropdown-btn');
            const dropdownContent = document.querySelector('.dropdown-content');
            const header = document.querySelector('.landing-page-header');
            
            let lastScrollTop = 0;
            let scrollTimeout; 
            window.addEventListener('scroll', function() {
                let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    if (dropdownContent && dropdownContent.classList.contains('show')) {
                        dropdownContent.classList.remove('show');
                        dropdownBtn.classList.remove('active');
                    }
                }, 40); 
                if (scrollTop > lastScrollTop && scrollTop > 50) {
                    header.classList.add('header-hidden');
                } else {
                    header.classList.remove('header-hidden');
                }
                if (scrollTop > 50) {
                    header.classList.add('header-solid-bg');
                } else {
                    header.classList.remove('header-solid-bg');
                }
                lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
            }, false);
            
            if (dropdownBtn) {
                dropdownBtn.addEventListener('click', (event) => {
                    event.stopPropagation();
                    const isShown = dropdownContent.classList.toggle('show');
                    dropdownBtn.classList.toggle('active', isShown);
                });
            }
            window.addEventListener('click', (event) => {
                if (dropdownContent && dropdownContent.classList.contains('show')) {
                    dropdownContent.classList.remove('show');
                    dropdownBtn.classList.remove('active');
                            }
                        });
                    
                        // --- 파일 업로드 기능 스크립트 (수정) ---
            const dropAreaGeneral = document.getElementById('drop-area-general');
            const fileInputGeneral = document.getElementById('file-input-general');
            const dropAreaSroi = document.getElementById('drop-area-sroi');
            const fileInputSroi = document.getElementById('file-input-sroi');
                    
            const fileList = document.getElementById('file-list');
            const filePlaceholder = document.getElementById('file-placeholder');
            const generateBtn = document.getElementById('generate-report-btn');
                    
            const checkGeneral = document.getElementById('check-general');
            const checkSroi = document.getElementById('check-sroi');
                    
            let generalFiles = [];
            let sroiFile = null;
                    
            // 각 드롭 영역 클릭 시 해당 파일 입력 창 열기
            dropAreaGeneral.addEventListener('click', () => fileInputGeneral.click());
            dropAreaSroi.addEventListener('click', () => fileInputSroi.click());
                    
            // 파일 선택 이벤트
            fileInputGeneral.addEventListener('change', () => handleFiles(fileInputGeneral.files, 'general'));
            fileInputSroi.addEventListener('change', () => handleFiles(fileInputSroi.files, 'sroi'));
                    
            // 드래그 이벤트 공통 처리 함수
            function setupDragEvents(dropArea, fileType) {
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropArea.addEventListener(eventName, e => {
                        e.preventDefault();
                        e.stopPropagation();
                    }, false);
                });
                ['dragenter', 'dragover'].forEach(eventName => {
                    dropArea.addEventListener(eventName, () => dropArea.classList.add('is-dragging'), false);
                });
                ['dragleave', 'drop'].forEach(eventName => {
                    dropArea.addEventListener(eventName, () => dropArea.classList.remove('is-dragging'), false);
                });
                dropArea.addEventListener('drop', (e) => handleFiles(e.dataTransfer.files, fileType));
            }

            setupDragEvents(dropAreaGeneral, 'general');
            setupDragEvents(dropAreaSroi, 'sroi');

            function handleFiles(files, fileType) {
                if (fileType === 'sroi') {
                    sroiFile = files[0]; // SROI는 단일 파일
                } else {
                    [...files].forEach(file => {
                        if (!generalFiles.some(f => f.name === file.name && f.size === file.size)) {
                            generalFiles.push(file);
                        }
                    });
                }
                updateFileList();
            }

            function updateFileList() {
                fileList.innerHTML = ''; // 목록 초기화
                const allFiles = [...generalFiles];
                if (sroiFile) {
                    allFiles.push(sroiFile);
                }

                if (allFiles.length > 0) {
                    filePlaceholder.style.display = 'none';
                    generateBtn.disabled = false;
                } else {
                    filePlaceholder.style.display = 'flex';
                    generateBtn.disabled = true;
                }
            
                // 파일 목록 UI 업데이트
                allFiles.forEach((file, index) => {
                    const li = document.createElement('li');
                    li.classList.add('file-item');
                    li.innerHTML = `
                        <div class="file-info">
                            <svg class="file-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>
                            <span class="file-name">${file.name}</span>
                        </div>
                        <button class="remove-btn" data-name="${file.name}">&times;</button>
                    `;
                    fileList.appendChild(li);
                });
            
                // 체크리스트 상태 업데이트
                checkGeneral.classList.toggle('checked', generalFiles.length > 0);
                checkSroi.classList.toggle('checked', sroiFile !== null);
            }

            // 파일 삭제 버튼 클릭 (수정)
            fileList.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-btn')) {
                    const fileName = e.target.dataset.name;
                    // generalFiles에서 삭제
                    generalFiles = generalFiles.filter(f => f.name !== fileName);
                    // sroiFile에서 삭제
                    if (sroiFile && sroiFile.name === fileName) {
                        sroiFile = null;
                    }
                    updateFileList();
                }
            });

            // 리포트 생성 버튼 클릭
            generateBtn.addEventListener('click', () => {
                if (!generateBtn.disabled) {
                    window.location.href = 'generating.html';
                }
            });
        });
    </script>
</body>
</html>
