<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Impact Report - {{ company_name }}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- 기본 설정 --- */
        :root {
            --primary-green: #27AE60;
            --dark-blue: #0d3d56;
            --text-dark: #2c3e50;
            --text-light: #5D6D7E;
            --bg-light: #f8f9fa;
            --border-color: #e9ecef;
            --accent-blue: #3498DB;
            --accent-orange: #FFC107;
        }
        * { box-sizing: border-box; }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            background-color: var(--bg-light);
            color: var(--text-dark);
        }
        .page {
            width: 210mm;
            min-height: 297mm;
            padding: 25mm;
            margin: 20mm auto;
            background: #ffffff;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            position: relative;
            animation: fade-in 0.6s ease-out forwards;
        }
        h1, h2, h3, h4 {
            font-family: 'Poppins', 'Roboto', sans-serif;
            font-weight: 700;
            margin: 0;
        }
        p {
            line-height: 1.9;
            font-size: 10pt;
            color: var(--text-light);
            font-weight: 400;
        }
        ul { padding-left: 20px; }
        li {
            margin-bottom: 10px;
        }
        li strong {
            color: var(--text-dark);
            font-weight: 700;
        }
        .cover-page {
            padding: 0;
            justify-content: flex-start;
            align-items: flex-start;
            background: url('../image/reportbg.png') no-repeat center center;
            background-size: cover;
            color: #fff;
        }
        .cover-text {
            padding: 60px;
            margin-top: 120px;
            text-align: left;
            line-height: 1.3;
            text-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }
        .cover-text .line1 { font-size: 2rem; letter-spacing: 4px; }
        .cover-text .line2 { font-size: 4.2rem; font-weight: 300; letter-spacing: 1px; }
        .cover-text .line3 { font-size: 3rem; font-weight: 200; margin-top: 8px; }
        .cover-text .line4 { font-size: 1.8rem; font-weight: 300; margin-top: 20px; }
        .main-title {
            font-size: 26pt;
            color: var(--primary-green);
            padding-bottom: 15px;
            margin-bottom: 40px;
            border-bottom: 3px solid var(--primary-green);
        }
        .page-footer {
            margin-top: auto;
            text-align: center;
            font-size: 9pt;
            color: #aaa;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            width: calc(100% - 50mm);
            position: absolute;
            bottom: 10mm;
            left: 25mm;
        }
        .page-logo {
            position: absolute;
            top: 5mm;
            right: 20mm;
            width: 120px;
            height: auto;
        }
        .section { margin-bottom: 35px; }
        .section-title {
            font-size: 18pt;
            color: var(--text-dark);
            margin-bottom: 25px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .sub-title {
            font-size: 14pt;
            color: var(--text-dark);
            margin-bottom: 20px;
            font-weight: 600;
        }
        .grid-container-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
        .sdg-main-subtitle {
            font-size: 12pt;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 15px;
        }
        .sdg-goal-group { margin-bottom: 25px; }
        .sdg-goal-group:last-child { margin-bottom: 0; }
        .sdg-card-new {
            display: flex;
            align-items: center;
            gap: 20px;
            background-color: #fff;
            border: 1px solid var(--border-color);
            padding: 20px;
            border-radius: 12px;
        }
        .sdg-color-box {
            width: 50px;
            height: 50px;
            flex-shrink: 0;
            border-radius: 8px;
            background-size: cover;
            background-position: center;
        }
        .sdg-text-content h4 { font-size: 10pt; font-weight: 600; margin-bottom: 8px; }
        .sdg-text-content p { font-size: 9pt; line-height: 1.6; margin: 0; }
        .sdg-detail-goal {
            margin-top: 10px;
            padding: 20px;
            background-color: var(--bg-light);
            border-radius: 8px;
            border-left: 4px solid var(--primary-green);
        }
        .sdg-detail-goal p { font-size: 10pt; margin: 0; color: var(--text-light); }
        .sdg-detail-goal strong { font-weight: 700; color: var(--text-dark); margin-right: 9px; }
        .info-box-new {
            background: linear-gradient(135deg, #F9F9F9, #FFFFFF);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            border-left: 5px solid var(--primary-green);
        }
        .info-box-new p { font-size: 10pt; color: var(--text-dark); margin: 0; }
        .info-box-new strong { color: var(--primary-green); font-weight: 700; }
        .kpi-card-new {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 160px; /* 모든 박스의 최소 높이를 지정하여 크기를 통일 */
            min-width: 0; /* 컨텐츠가 그리드 박스를 넘어서는 것을 방지 */
        }
        .kpi-card-new h4 {
            font-size: 8pt;
            color: var(--text-light);
            margin-bottom: 15px;
            font-weight: 500;
            min-height: 3em;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        .kpi-card-new .value-wrapper {
            line-height: 1.2;
        }
        .kpi-card-new .value {
            font-family: 'Poppins', sans-serif;
            font-size: 24pt;
            font-weight: 700;
            color: var(--primary-green);
            overflow-wrap: break-word; /* 긴 숫자가 박스를 넘지 않도록 설정 */
            display: block;
        }
        .kpi-card-new .value.blue { color: var(--accent-blue); }
        .kpi-card-new .value.accent { color: var(--accent-orange); }
        .kpi-card-new .unit { 
            font-size: 9pt; 
            color: var(--text-light); 
            display: block;
            margin-top: 5px; 
        }
        .kpi-card-new .unit-sub {
            display: block;
            font-size: 8pt;
            color: var(--text-light);
            margin-top: 2px;
        }
        .analysis-item {
            display: grid;
            grid-template-columns: 150px 1fr;
            align-items: start;
            gap: 25px;
            margin-bottom: 30px;
        }
        .analysis-item.right-title { grid-template-columns: 1fr 150px; }
        .analysis-item h3 {
            font-size: 15pt;
            color: #fff;
            background: var(--dark-blue);
            padding: 25px 20px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
        }
        .analysis-item p { margin: 0; padding-top: 5px; }
        .chart-container {
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            background: #fff;
        }
        .chart-area {
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            height: 280px;
            padding: 20px 0;
            border-left: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }
        .bar-group {
            width: 25%;
            height: 100%;
            text-align: center;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: flex-end;
        }
        .bar {
            width: 50px;
            border-radius: 4px 4px 0 0;
            position: relative;
            background: var(--dark-blue);
            z-index: 1;
            transition: height 0.7s ease-out;
        }
        .bar-label {
            position: absolute;
            bottom: -45px;
            width: 100%;
            left: 0;
            font-size: 10pt;
            font-weight: 500;
            color: var(--text-light);
        }
        .bar-value {
            position: absolute;
            top: -25px;
            width: 100%;
            left: 0;
            font-size: 12pt;
            font-weight: 700;
            color: var(--text-dark);
            opacity: 0;
            transition: opacity 0.5s ease-in 0.5s;
        }
        .bar:hover .bar-value {
            opacity: 1;
        }
        .notice-box, .financial-notice {
            margin-top: 15px;
            padding: 15px;
            background-color: #fef9e7;
            border: 1px solid #f8e5a6;
            border-left: 5px solid var(--accent-orange);
            border-radius: 8px;
        }
        .notice-box p, .financial-notice p {
            margin: 0;
            color: #8a6d3b;
            font-size: 9pt;
            line-height: 1.7;
        }
        /* --- PDF 인쇄 전용 스타일 --- */

    @page {
        margin: 0; /* << 📄 이 부분을 추가해야 합니다. */
    }

    @media print {
        .page {
            margin: 0;
            box-shadow: none;
        }
    }
    </style>
</head>
<body>

<div class="page cover-page">
    <div class="cover-text">
        <div class="line1">Code Green</div>
        <div class="line2">Impact Report</div>
        <div class="line3">2025</div>
        <div class="line4">{{ company_name }}</div>
    </div>
</div>

<div class="page">
    <img src="../image/A.Impact.png" alt="A.Impact Logo" class="page-logo">
    <h1 class="main-title">I. 기업 분석</h1>
    <div class="section">
        <h2 class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
            기업 소개
        </h2>
        <p>{{ company_summary }}</p>
    </div>
    <div class="section">
        <h2 class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/><path d="M12 2a10 10 0 0 0-10 10c0 4.29 2.68 7.94 6.38 9.38"/><path d="M22 12a10 10 0 0 0-9.38-6.38C16.91 3.32 20.66 7 22 12z"/></svg>
            SDGs 연계
        </h2>
        <h3 class="sdg-main-subtitle">주요 목표 및 세부 목표</h3>
        <div>
            {% for main_key, main_value in sdgs_main.items() %}
            <div class="sdg-goal-group">
                <div class="sdg-card-new">
                    <div class="sdg-color-box" style="background-image: url('../image/sdg_image/sdg{{ main_key }}.png');"></div>
                    <div class="sdg-text-content">
                        <h4>SDG {{ main_key }}: {{ main_value.split('—')[0].strip() }}</h4>
                        <p>{{ main_value.split('—')[1].strip() }}</p>
                    </div>
                </div>
                <div class="sdg-detail-goal">
                    {% for sub_key, sub_value in sdgs_sub.items() %}
                        {% if sub_key.startswith(main_key + '.') %}
                        <p><strong>SDG {{ sub_key }}:</strong> {{ sub_value.split('—')[0].strip() }}</p>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="page-footer">2</div>
</div>

<div class="page">
    <img src="../image/A.Impact.png" alt="A.Impact Logo" class="page-logo">
    <div class="section">
        <h2 class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>
            사회적 가치 창출 포인트 
        </h2>
        <p>{{ social_value_point }}</p>
        <div class="info-box-new" style="margin-top: 20px;">
            <p><strong>💡AI 해설:</strong> {{ ai_explain }}<br>
            </p>
        </div>
    </div>
    <h1 class="main-title" style="margin-top: 20px; margin-bottom: 20px;">II. 임팩트-재무 KPI 연동 대시보드</h1>
    <div class="section">
        <h2 class="sub-title">핵심 성과 지표 (Total)</h2>
        <div class="grid-container-4">
            {% for kpi in impact_kpis %}
            {% set color_class = loop.cycle('', 'blue', 'blue', 'accent') %}
            <div class="kpi-card-new">
                <h4>{{ kpi.name | replace('<br>', ' ') }}</h4>
                <div class="value-wrapper">
                    <span class="value {{ color_class }}"><span class="number-to-format">{{ kpi.value }}</span></span>
                    <span class="unit">{{ kpi.unit }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% if note %}
        <div class="notice-box">
            <p><strong>참고:</strong> {{ note }}</p>
        </div>
        {% endif %}
    </div>
    <div class="section">
        <h2 class="sub-title">핵심 효율성 지표 (매출 1억당)</h2>
        {% if linked_kpis and (linked_kpis | map(attribute='value') | sum) > 0 %}
        <div class="grid-container-4">
            {% for kpi in linked_kpis %}
            {% set color_class = loop.cycle('', 'blue', 'blue', 'accent') %}
            <div class="kpi-card-new">
                <h4>{{ kpi.name }}</h4>
                <div class="value-wrapper">
                    {% if '/' in kpi.unit %}
                        {% set unit_parts = kpi.unit.split('/') %}
                        <span class="value {{ color_class }}">
                            <span class="number-to-format">{{ "%.1f"|format(kpi.value|float) }}</span>
                        </span>
                        <span class="unit">{{ unit_parts[0] }}/</span>
                        <span class="unit-sub">{{ unit_parts[1] }}</span>
                    {% else %}
                        <span class="value {{ color_class }}">
                            <span class="number-to-format">{{ "%.1f"|format(kpi.value|float) }}</span>
                        </span>
                        <span class="unit">{{ kpi.unit }}</span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="financial-notice">
             <p><strong>참고:</strong> 핵심 성과 데이터가 없어 관련 지표가 표시되지 않았습니다. 정확한 분석을 원하시면 성과 데이터를 업로드하여 리포트를 다시 생성해 주세요.</p>
        </div>
        {% endif %}
    </div>
    <div class="page-footer">3</div>
</div>

<div class="page">
    <img src="../image/A.Impact.png" alt="A.Impact Logo" class="page-logo">
    <h1 class="main-title">III. 상세 분석</h1>
    <div class="section">
        <h2 class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            IMP 기반 분석
        </h2>
        <div class="analysis-item">
            <h3>What</h3>
            <p>{{ what }}</p>
        </div>
        <div class="analysis-item right-title">
            <p>{{ who }}</p>
            <h3>Who</h3>
        </div>
    </div>
    <div class="section">
        <div class="analysis-item">
            <h3>How much</h3>
            <p>{{ how_much }}</p>
        </div>
        <div class="analysis-item right-title">
            <p>{{ risk }}</p>
            <h3>Risk</h3>
        </div>
    </div>
    <div class="page-footer">4</div>
</div>

<div class="page">
    <img src="../image/A.Impact.png" alt="A.Impact Logo" class="page-logo">
    <h1 class="main-title">IV. 변화량 및 확장 전략</h1>
    <div class="section">
        <h2 class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
            매출액 추이 
        </h2>
        <div class="notice-box">
             <p>참고: 표시할 매출 추이 데이터가 없습니다. 분석을 원하시면 관련 데이터를 업로드해 주세요.</p>
        </div>
    </div>
    <div class="section">
    <h2 class="section-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h6v6"/><path d="M10 14 21 3"/><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/></svg>
        GRI 지표 추천
    </h2>
    <ul id="gri-list">
        {% for item in gri_main %}
        <li><strong>{{ item.item_name }} (GRI {{ item.item_code }}):</strong> {{ item.reason }}</li>
        {% endfor %}
    </ul>
</div>
    <div class="page-footer">5</div>
</div>

<div class="page">
    <img src="../image/A.Impact.png" alt="A.Impact Logo" class="page-logo">
    <h1 class="main-title">V. AI 요약</h1>
    <div class="section">
        <h2 class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/></svg>
            종합 평가
        </h2>
        <p>{{ ai_summary }}</p>
    </div>
    <div class="section">
        <h2 class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
            주요 성과 요약
        </h2>
        <div class="info-box-new">
            <p>요약할 충분한 성과 데이터가 없습니다. 정확한 분석을 원하시면 관련 데이터를 업로드하여 리포트를 다시 생성해 주세요.</p>
        </div>
    </div>
    <div class="page-footer">6</div>
</div>

<div class="page">
    <img src="../image/A.Impact.png" alt="A.Impact Logo" class="page-logo">
    <h1 class="main-title">VI. 부록</h1>
    <div class="section">
        <h2 class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>
            데이터 출처 및 방법론
        </h2>
        <ul>
            <li><strong>핵심 성과 지표 데이터:</strong> 본 보고서의 핵심 성과 지표는 <strong>제출된 자료를 기반으로 산출</strong>되었으며, 분석 시점 및 데이터의 최신성에 따라 실제 값과 차이가 있을 수 있습니다.</li>
            <li><strong>임팩트 측정 방법론:</strong> 본 보고서는 <strong>MSCI SDG Alignment Methodology</strong>, <strong>GRI Standards 2021</strong>, <strong>Impact Management Project (IMP) 프레임워크</strong>를 참고하여 작성되었습니다.</li>
        </ul>
    </div>
    <div class="section">
        <h2 class="section-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
            용어 설명
        </h2>
        <p><strong>GRI (Global Reporting Initiative):</strong> <strong>지속가능성 보고서에 대한 가이드라인</strong>을 제시하는 국제기구. 전 세계적으로 가장 널리 채택되는 표준 중 하나입니다.</p>
        <p><strong>IMP (Impact Management Project):</strong> 기업 및 투자자가 임팩트를 측정하고 관리하는 방법에 대한 글로벌 컨센서스를 구축하는 프로젝트입니다.</p>
        <p><strong>SDGs (Sustainable Development Goals):</strong> 2030년까지 전 세계가 함께 달성하기로 약속한 17개의 지속가능발전목표입니다.</p>
    </div>
    <div class="page-footer">7</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // --- Client-Side Enhancements ---
    // 이 스크립트는 Jinja2에 의해 페이지가 렌더링된 후 브라우저에서 실행됩니다.

    /**
     * 숫자를 '만', '억', '조' 단위의 한글 형식으로 변환합니다.
     * 10,000 미만의 숫자는 쉼표를 추가하여 반환합니다.
     * 소수점 첫째 자리까지 표시하며, .0으로 끝나는 경우는 정수로 표시합니다.
     * @param {number|string} num - 변환할 숫자
     * @returns {string} - 변환된 문자열 (예: "1.2만", "50억")
     */
    const formatKoreanNumberUnit = (num) => {
        const number = parseFloat(String(num).replace(/,/g, ''));
        if (isNaN(number)) return num; // 숫자가 아니면 원래 값 반환

        if (number >= 1000000000000) {
            const formatted = (number / 1000000000000).toFixed(1).replace(/\.0$/, '');
            return `${formatted}조`;
        }
        if (number >= 100000000) {
            const formatted = (number / 100000000).toFixed(1).replace(/\.0$/, '');
            return `${formatted}억`;
        }
        if (number >= 10000) {
            const formatted = (number / 10000).toFixed(1).replace(/\.0$/, '');
            return `${formatted}만`;
        }
        // 10,000 미만은 쉼표만 추가
        return number.toLocaleString('ko-KR');
    };

    /**
     * --- 수정된 함수 ---
     * 요소의 텍스트가 부모 컨테이너 너비를 초과하지 않도록 폰트 크기를 동적으로 조절합니다.
     * @param {HTMLElement} element - 폰트 크기를 조절할 텍스트 요소 (e.g., a <span>)
     */
    const adjustFontSize = (element) => {
        // 너비의 기준이 되는 부모 컨테이너(.kpi-card-new)를 찾습니다.
        const container = element.closest('.kpi-card-new');
        if (!container) return;

        const containerStyles = window.getComputedStyle(container);
        // 컨테이너의 내부 패딩 값을 제외한 실제 사용 가능한 너비를 계산합니다.
        const paddingLeft = parseFloat(containerStyles.paddingLeft);
        const paddingRight = parseFloat(containerStyles.paddingRight);
        const availableWidth = container.clientWidth - paddingLeft - paddingRight;

        // 폰트 크기 조절 전, 원래 CSS에 지정된 값으로 초기화합니다.
        element.style.fontSize = ''; 
        let fontSize = parseFloat(window.getComputedStyle(element).fontSize);
        
        // 텍스트가 한 줄일 때의 전체 너비를 측정하기 위해 임시로 white-space 속성을 변경합니다.
        element.style.whiteSpace = 'nowrap';

        // 텍스트의 너비가 사용 가능한 너비보다 크면, 폰트 크기를 1px씩 줄입니다.
        while (element.scrollWidth > availableWidth && fontSize > 8) {
            fontSize -= 1; 
            element.style.fontSize = `${fontSize}px`;
        }
        
        // 측정이 끝난 후 white-space 속성을 원래대로 되돌립니다.
        element.style.whiteSpace = '';
    };

    // --- 수정된 부분: 함수 호출 로직 ---
    // 1. KPI 숫자를 한글 단위 포맷으로 변경하고 폰트 크기 조절
    document.querySelectorAll('.number-to-format').forEach(span => {
        const originalValue = span.textContent.trim();
        const formattedValue = formatKoreanNumberUnit(originalValue);
        span.textContent = formattedValue;
        // 부모(.value) 요소의 폰트 크기를 조절
        adjustFontSize(span.parentElement);
    });

    // 2. 차트 바 애니메이션 효과
    document.querySelectorAll('.bar').forEach((bar, index) => {
        const finalHeight = bar.dataset.height;
        const barValue = bar.querySelector('.bar-value');
        
        // 순차적으로 애니메이션 시작
        setTimeout(() => {
            bar.style.height = finalHeight;
            if(barValue) {
                barValue.style.opacity = 1;
            }
        }, 150 * index);
    });
});
</script>

</body>
</html>
