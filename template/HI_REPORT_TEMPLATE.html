<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hidden Impact Scanner - {{ company_name }}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #007bff;
            --positive-color: #28a745;
            --negative-color: #fd7e14;
            --gold-color: #ffd700;
            --silver-color: #c0c0c0;
            --bronze-color: #cd7f32;
            --text-color: #343a40;
            --light-gray: #f8f9fa;
            --border-color: #e9ecef;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            background-color: #f0f2f5;
            color: var(--text-color);
        }
        .page {
            width: 210mm;
            height: 297mm;
            padding: 20mm;
            margin: 20mm auto;
            background: #ffffff;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            position: relative;
        }
        h1, h2, h3, h4, h5 {
            font-family: 'Poppins', 'Roboto', sans-serif;
            font-weight: 700;
            margin: 0;
        }
        p, li {
            line-height: 1.8; 
            font-size: 10pt; 
            color: #555; 
        }

        /* --- í˜ì´ì§€ ë¡œê³  --- */
        .page-logo {
            position: absolute;
            top: 5mm;
            right: 5mm;
            width: 120px;
            height: auto;
        }

        /* --- í‘œì§€ ìŠ¤íƒ€ì¼ --- */
        .cover-page {
            padding: 0;
            justify-content: flex-start;
            align-items: flex-start;
            background: url('../image/impact_scanner.png') no-repeat center center;
            background-size: cover;
            color: #fff;
        }
        .cover-text {
            padding: 60px;
            margin-top: 120px;
            text-align: left;
            line-height: 1.3;
            text-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }
        .cover-text .line1 { font-size: 2rem; letter-spacing: 4px; }
        .cover-text .line2 { font-size: 4.2rem; font-weight: 300; letter-spacing: 1px; }
        .cover-text .line3 { font-size: 3rem; font-weight: 200; margin-top: 8px; }
        .cover-text .line4 { font-size: 1.8rem; font-weight: 300; margin-top: 20px; }

        /* --- í—¤ë” --- */
        .scanner-header { text-align: center; margin-bottom: 30px; }
        .scanner-header h1 { font-size: 24pt; color: #212529; margin-bottom: 10px; }
        .scanner-header .company-name { color: var(--primary-color); }
        .scanner-header p { font-size: 11pt; color: #6c757d; }

        /* --- êµ¬ë¶„ì„  --- */
        .light-divider { border: 0; height: 1px; background-color: var(--border-color); margin: 0px 0; margin-top: -35px; }
        .light-divider-page3 { 
            border: 0; 
            height: 1px; 
            background-color: var(--border-color); 
            margin: 30px 0;
        }

        /* --- MSCI SDGs ìœ ì‚¬ë„ TOP 3 --- */
        .scorecard-section h2 { font-size: 16pt; text-align: center; margin-top: 10px;}
        .sdg-ranking-container { display: flex; justify-content: center; align-items: flex-end; gap: 20px; margin-top: 20px; text-align: center; min-height: 220px; }
        .sdg-rank-item { display: flex; flex-direction: column; align-items: center; justify-content: space-between; padding: 20px 10px; border-radius: 12px; width: 150px; box-shadow: 0 8px 25px rgba(108, 117, 125, 0.1); border: 1px solid var(--border-color); transition: all 0.3s ease; }
        .sdg-rank-item:hover { transform: translateY(-8px) scale(1.03); box-shadow: 0 12px 35px rgba(108, 117, 125, 0.2); }
        .sdg-rank-item.rank-1 { order: 2; height: 220px; background: linear-gradient(145deg, #fff, #fffbeb); border-color: var(--gold-color); }
        .sdg-rank-item.rank-2 { order: 1; height: 200px; background-color: var(--light-gray); }
        .sdg-rank-item.rank-3 { order: 3; height: 180px; background-color: var(--light-gray); }
        .rank-badge { font-size: 18pt; font-weight: 700; font-family: 'Poppins', sans-serif; }
        .sdg-rank-item.rank-1 .rank-badge { color: var(--gold-color); text-shadow: 0 0 10px rgba(255,215,0,0.5); }
        .sdg-rank-item.rank-2 .rank-badge { color: var(--silver-color); }
        .sdg-rank-item.rank-3 .rank-badge { color: var(--bronze-color); }
        .sdg-icon { width: 100px; height: 100px; border-radius: 8px; object-fit: cover; }
        .sdg-score { font-family: 'Poppins', sans-serif; font-size: 13pt; font-weight: 600; color: var(--text-color); }
        .sdg-reasons { margin-top: 25px; padding: 0 10px; }
        .sdg-reasons h3 { font-size: 13pt; text-align: center; margin-bottom: 20px; color: var(--text-color); }
        .sdg-reasons ul { list-style-type: none; padding: 0; margin: 0; }
        .sdg-reasons li { font-size: 10pt; margin-bottom: 10px; line-height: 1.6; }
        .sdg-reasons li strong { color: var(--primary-color); font-weight: 700; }

        /* --- ì†Œì…œ ì„íŒ©íŠ¸ ìµœì¢… ì ìˆ˜ --- */
        .final-score-section { display: flex; gap: 30px; align-items: center; background: var(--light-gray); padding: 15px; border-radius: 12px; margin-top: 25px; }
        .score-display { min-width: 150px; height: 150px; position: relative; display: flex; justify-content: center; align-items: center; }
        .score-circle { width: 100%; height: 100%; transform: rotate(-90deg); }
        .score-circle-bg { stroke: var(--border-color); }
        .score-circle-fg { stroke: url(#scoreGradientLight); stroke-dasharray: 410; stroke-dashoffset: 410; transition: stroke-dashoffset 1.5s ease-out; }
        .score-text { position: absolute; font-family: 'Poppins', sans-serif; font-weight: 700; font-size: 28pt; color: var(--text-color); }
        .score-details { flex-grow: 1; }
        .score-details h2 { font-size: 16pt; color: var(--text-color); margin-bottom: 5px; }
        .score-details h3 { font-size: 12pt; color: var(--text-color); margin-bottom: 2px; }
        
        /* --- AI ì»¨ì„¤í„´íŠ¸ --- */
        .ai-consultant-section h2 { text-align: center; font-size: 16pt; color: #212529; margin-bottom: 25px; }
        .ai-cards-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; align-items: start; }
        .ai-card { 
            background: #ffffff; 
            border-radius: 12px; 
            padding: 25px; 
            transition: all 0.3s ease; 
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.08); 
            border-top: 4px solid var(--primary-color);
            height: 300px; /* ê³ ì • ë†’ì´ ì„¤ì • */
            display: flex;
            flex-direction: column;
            align-items: center; /* ì•„ì´ì½˜ê³¼ ì œëª© ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•´ ì¶”ê°€ */
            text-align: center;
        }
        .ai-card:hover { transform: translateY(-8px) scale(1.03); box-shadow: 0 12px 35px rgba(108, 117, 125, 0.15); }
        .ai-card-icon { 
            width: 45px; 
            height: 45px; 
            margin-bottom: 15px; /* auto ë§ˆì§„ ì œê±° */
            color: var(--primary-color); 
            flex-shrink: 0; 
        }
        .ai-card h3 { color: var(--primary-color); font-size: 13pt; margin-bottom: 15px; flex-shrink: 0; }
        .ai-card-content { flex-grow: 1; overflow: hidden; text-align: left; width: 100%;} /* ë‚´ìš©ë¬¼ì€ ë‹¤ì‹œ ì™¼ìª½ ì •ë ¬, overflow: auto -> hiddenìœ¼ë¡œ ë³€ê²½ */
        .ai-card ul { padding-left: 20px; margin: 0; }
        .ai-card li { font-size: 9pt; margin-bottom: 5px; line-height: 1.5;} /* í°íŠ¸ ë° ê°„ê²© ì¡°ì • */
        .ai-card p { text-align: left; margin: 0; font-size: 9pt; line-height: 1.6;} /* í°íŠ¸ ë° ê°„ê²© ì¡°ì • */


        /* --- ì „ì²´ SDG ìŠ¤ì½”ì–´ì¹´ë“œ --- */
        .sdg-chart-section { margin-top: -10px; }
        .sdg-chart-section h2 { text-align: center; font-size: 16pt; color: #212529; margin-bottom: 20px; }
        .sdg-chart-container { display: grid;  grid-template-columns: repeat(2, 1fr);grid-template-rows: repeat(9, auto); grid-auto-flow: column; column-gap: 40px; row-gap: 8px; padding-left: 60px; padding-right: 30px; }
        .sdg-bar-label { font-size: 9pt; color: #555; margin-bottom: 4px; font-weight: 700; }
        .sdg-bar-row { display: flex; align-items: center; gap: 10px; }
        .sdg-bar-wrapper { flex-grow: 1; height: 18px; display: flex; background-color: #e9ecef; border-radius: 9px; position: relative; overflow: hidden; }
        .sdg-bar-wrapper::before { content: ''; position: absolute; left: 50%; top: 0; bottom: 0; width: 2px; background-color: #fff; transform: translateX(-50%); z-index: 1;}
        .sdg-bar-negative, .sdg-bar-positive { height: 100%; display: flex; }
        .sdg-bar-negative { width: 50%; justify-content: flex-end; }
        .sdg-bar-positive { width: 50%; justify-content: flex-start; }
        .sdg-bar-inner { height: 100%; }
        .sdg-bar-inner.positive { background: linear-gradient(90deg, #66bb6a, #43a047); }
        .sdg-bar-inner.negative { background: linear-gradient(270deg, #dc2626, #fb8c00); }
        .sdg-bar-score { width: 40px; flex-shrink: 0; font-size: 10pt; font-weight: 600; font-family: 'Poppins', sans-serif; text-align: right; }

        /* --- ë¶€ë¡ --- */
        .appendix-section { margin-top: 15px; }
        .appendix-title { font-size: 14pt; color: #212529; margin-bottom: 15px; border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; }
        .appendix-content { border: none; padding: 0; }
        .appendix-content ul { padding-left: 20px; margin: 0; column-count: 2; column-gap: 40px; }
        .appendix-content li { font-size: 9pt; margin-bottom: 10px; }
        
        /* --- í˜ì´ì§€ í‘¸í„° --- */
        .page-footer {
            margin-top: auto;
            text-align: center;
            font-size: 9pt;
            color: #aaa;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            width: calc(100% - 40mm);
            position: absolute;
            bottom: 10mm;
            left: 20mm;
        }
         @page {
        margin: 0; /* << ğŸ“„ ì´ ë¶€ë¶„ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤. */
    }

/* --- ì¸ì‡„ìš© ìŠ¤íƒ€ì¼ (ë ˆì´ì•„ì›ƒ ìµœì†Œ ë³€ê²½ ë²„ì „) --- */
@media print {
    body {
        background-color: #fff;
    }

    /* ì›¹ê³¼ ë™ì¼í•œ ëª¨ì–‘ì„ ìœ„í•´ ê·¸ë¦¼ì, ì „í™˜ íš¨ê³¼ ë“±ì€ ê·¸ëŒ€ë¡œ ë‘¡ë‹ˆë‹¤. */
    
    .page {
        margin: 0; /* ìƒë‹¨ ì—¬ë°± ë¬¸ì œë§Œ í•´ê²° */
        box-shadow: none; /* ì¸ì‡„ ì‹œ ë¶ˆí•„ìš”í•œ ê·¸ë¦¼ìë§Œ ì œê±° */
        page-break-after: always;
    }

    .page:last-child {
        page-break-after: auto;
    }

    /* ë°°ê²½ ì´ë¯¸ì§€ ê°•ì œ ì¸ì‡„ */
    .cover-page {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
    }
}
    </style>
</head>
<body>

<div class="page cover-page">
    <div class="cover-text">
        <div class="line1">Code Green</div>
        <div class="line2">Hidden Impact</div>
        <div class="line3">{{ meta.generated_at.split('-')[0] }}</div>
        <div class="line4">{{ company_name }}</div>
    </div>
</div>

<div class="page">
    <img src="../image/A.Impact.png" alt="A.Impact Logo" class="page-logo">
    <div class="scanner-header">
        <h1><span class="company-name">{{ company_name }}</span>ì˜ Hidden Impact</h1>
        <p>ì‚°ì—…êµ°: {{ industry_type }}</p>
    </div>
    <hr class="light-divider">
    <div class="scorecard-section">
        <h2>MSCI ê¸°ì¤€ SDGs ìœ ì‚¬ë„ TOP 3</h2>
        <div class="sdg-ranking-container">
            {% for item in top3 %}
            <div class="sdg-rank-item rank-{{ loop.index }}">
                <div class="rank-badge">
                    {% if loop.index == 1 %}1st{% elif loop.index == 2 %}2nd{% else %}3rd{% endif %}
                </div>
                <img src="../image/sdg_image/sdg{{ item.sdg | replace('SDG ', '') }}.png" alt="{{ item.sdg }} Icon" class="sdg-icon">
                <h5 class="sdg-score">{{ "%.1f"|format(item.net_alignment_score|float) }} / 10</h5>
            </div>
            {% endfor %}
        </div>
        <div class="sdg-reasons">
            <h3>TOP 3 ì„ ì • ì´ìœ </h3>
            <ul>
                {% for item in top3 %}
                <li><strong>{% if loop.index == 1 %}1st{% elif loop.index == 2 %}2nd{% else %}3rd{% endif %} ({{ item.sdg }}):</strong> {{ item.reason }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="final-score-section">
        <div class="score-display">
            <svg class="score-circle" viewBox="0 0 150 150">
                <defs>
                    <linearGradient id="scoreGradientLight" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#28a745" />
                        <stop offset="100%" stop-color="#007bff" />
                    </linearGradient>
                </defs>
                <circle class="score-circle-bg" cx="75" cy="75" r="65" stroke-width="15" fill="none"/>
                <circle id="score-circle-fg" class="score-circle-fg" cx="75" cy="75" r="65" stroke-width="15" fill="none"/>
            </svg>
            <div class="score-text" id="final-score-text">{{ "%.1f"|format(rating_result.social_impact_rate|float) }}/10</div>
        </div>
        <div class="score-details">
            <h2>ì†Œì…œ ì„íŒ©íŠ¸ ìµœì¢… ì ìˆ˜</h2>
            <h3>í‰ê°€ ê·¼ê±°:</h3>
            <p id="justification-text">{{ rating_result.justification }}</p>
        </div>
    </div>
    <div class="page-footer">2</div>
</div>

<div class="page">
    <img src="../image/A.Impact.png" alt="A.Impact Logo" class="page-logo">
    <div class="ai-consultant-section">
        <h2>AI ì»¨ì„¤í„´íŠ¸ì˜ ëˆˆ</h2>
        <div class="ai-cards-container">
            <!-- Card 1: ì •ì²´ì„± ì§„ë‹¨ (í•˜ë“œì½”ë”©ëœ ì œëª©ê³¼ ì•„ì´ì½˜) -->
            <div class="ai-card">
                <svg xmlns="http://www.w3.org/2000/svg" class="ai-card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 14.66V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h5.34"></path><polygon points="18 2 22 6 12 16 8 16 8 12 18 2"></polygon></svg>
                <h3>ì •ì²´ì„± ì§„ë‹¨</h3>
                <div class="ai-card-content">
                    <ul>
                        {% for basis_item in consultant_report.identity_diagnosis.basis %}
                        <li>{{ basis_item }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <!-- Card 2: ë§ì¶¤ ì»¨ì„¤íŒ… (í•˜ë“œì½”ë”©ëœ ì œëª©ê³¼ ì•„ì´ì½˜) -->
            <div class="ai-card">
                <svg xmlns="http://www.w3.org/2000/svg" class="ai-card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>
                <h3>ë§ì¶¤ ì»¨ì„¤íŒ…</h3>
                <div class="ai-card-content">
                    <ul>
                        {% for rec in consultant_report.recommendations %}
                        <li><strong>{{ rec.initiative }}:</strong> {{ rec.reason }} (KPI: {{ rec.kpi }}, ê¸°í•œ: {{ rec.timeline }})</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <!-- Card 3: ì „ëµì  ë°©í–¥ ì œì‹œ (í•˜ë“œì½”ë”©ëœ ì œëª©ê³¼ ì•„ì´ì½˜) -->
            <div class="ai-card">
                <svg xmlns="http://www.w3.org/2000/svg" class="ai-card-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"></polygon></svg>
                <h3>ì „ëµì  ë°©í–¥ ì œì‹œ</h3>
                <div class="ai-card-content">
                   
                    <ul>
                        <li><strong>ì¥ê¸° ë¹„ì „:</strong> {{ consultant_report.strategic_direction.long_term_vision }}</li>
                        <li><strong>í¬ì§€ì…”ë‹:</strong> {{ consultant_report.strategic_direction.narrative_positioning }}</li>
                        <li><strong>ê¸°íšŒ/ìœ„í˜‘:</strong> {{ consultant_report.strategic_direction.challenges_and_opportunities }}</li>
                    </ul>
                    
                </div>
            </div>
        </div>
    </div>

    <hr class="light-divider-page3">

    <div class="sdg-chart-section">
        <h2>Hidden Impact Scorecard</h2>
        <div class="sdg-chart-container">
            {% for sdg in scorecard_full %}
            <div class="sdg-chart-item">
                <div class="sdg-bar-label">{{ sdg.name }}</div>
                <div class="sdg-bar-row">
                    <div class="sdg-bar-wrapper">
                        <div class="sdg-bar-negative">
                            <div class="sdg-bar-inner negative" style="width: {% if sdg.score < 0 %}{{ sdg.score|abs * 10 }}{% else %}0{% endif %}%"></div>
                        </div>
                        <div class="sdg-bar-positive">
                            <div class="sdg-bar-inner positive" style="width: {% if sdg.score > 0 %}{{ sdg.score * 10 }}{% else %}0{% endif %}%"></div>
                        </div>
                    </div>
                    <div class="sdg-bar-score">{{ "%.1f"|format(sdg.score|float) }}</div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="page-footer">3</div>
</div>

<div class="page">
    <img src="../image/A.Impact.png" alt="A.Impact Logo" class="page-logo">
    <div class="appendix-section" style="margin-top: 0;">
        <h3 class="appendix-title">(ë¶€ë¡) 17ê°œ ì§€ì†ê°€ëŠ¥ë°œì „ëª©í‘œ(SDGs)</h3>
        <div class="appendix-content">
            <ul>
                {% for sdg in scorecard_full %}
                <li><strong>{{ sdg.name }}:</strong> {{ sdg.description }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="page-footer">4</div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // ìµœì¢… ì ìˆ˜ ì›í˜• ì°¨íŠ¸ ì• ë‹ˆë©”ì´ì…˜
        const scoreTextElement = document.getElementById('final-score-text');
        if (scoreTextElement) {
            const scoreValue = parseFloat(scoreTextElement.textContent.split('/')[0]);
            if (!isNaN(scoreValue)) {
                const circle = document.getElementById('score-circle-fg');
                const radius = circle.r.baseVal.value;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - (scoreValue / 10) * circumference;
                setTimeout(() => {
                    circle.style.strokeDashoffset = offset;
                }, 100);
            }
        }

        // í‰ê°€ ê·¼ê±° í…ìŠ¤íŠ¸ í°íŠ¸ í¬ê¸° ë™ì  ì¡°ì ˆ
        const justificationElement = document.getElementById('justification-text');
        const scoreDisplayElement = document.querySelector('.score-display');
        
        if (justificationElement && scoreDisplayElement) {
            const detailsContainer = justificationElement.parentElement; // .score-details
            const h2 = detailsContainer.querySelector('h2');
            const h3 = detailsContainer.querySelector('h3');
            const totalHeight = scoreDisplayElement.clientHeight;
            
            let titlesHeight = 0;
            if (h2) {
                const h2Styles = window.getComputedStyle(h2);
                titlesHeight += h2.offsetHeight + parseFloat(h2Styles.marginBottom);
            }
            if (h3) {
                const h3Styles = window.getComputedStyle(h3);
                titlesHeight += h3.offsetHeight + parseFloat(h3Styles.marginBottom);
            }

            const availableHeightForP = totalHeight - titlesHeight;

            justificationElement.style.fontSize = ''; 
            const defaultFontSize = parseFloat(window.getComputedStyle(justificationElement).fontSize);
            let fontSize = defaultFontSize;
            
            while (justificationElement.scrollHeight > availableHeightForP && fontSize > 8) {
                fontSize -= 0.5;
                justificationElement.style.fontSize = `${fontSize}px`;
            }
        }

        // AI ì¹´ë“œ ì»¨í…ì¸  í°íŠ¸ í¬ê¸° ë™ì  ì¡°ì ˆ
        function adjustCardFontSize(cardContentElement) {
            const children = cardContentElement.querySelectorAll('ul, p, li, strong');
            if (children.length === 0) return;

            // í°íŠ¸ í¬ê¸°ë¥¼ ì¬ì„¤ì •í•˜ì—¬ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‹œì‘
            children.forEach(child => child.style.fontSize = '');

            // ì²« ë²ˆì§¸ ìì‹ ìš”ì†Œì—ì„œ ê¸°ë³¸ í°íŠ¸ í¬ê¸°ë¥¼ ê°€ì ¸ì˜´
            const defaultFontSize = parseFloat(window.getComputedStyle(children[0]).fontSize);
            let currentFontSize = defaultFontSize;

            // ë‚´ìš©ì´ ì»¨í…Œì´ë„ˆë¥¼ ë²—ì–´ë‚˜ë©´ í°íŠ¸ í¬ê¸°ë¥¼ ì¤„ì„
            while (cardContentElement.scrollHeight > cardContentElement.clientHeight && currentFontSize > 8) {
                currentFontSize -= 0.5;
                children.forEach(child => {
                    child.style.fontSize = `${currentFontSize}px`;
                });
            }
        }

        document.querySelectorAll('.ai-card-content').forEach(adjustCardFontSize);
    });
</script>

</body>
</html>
